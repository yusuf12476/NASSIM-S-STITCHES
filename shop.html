<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shop - Nassim's Stitches</title>
    <link rel="stylesheet" href="style.css">
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="images/Gemini_Generated_Image_eoegjueoegjueoeg.png">
    <!-- Google Fonts for an elegant look -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Montserrat:wght@400;500&display=swap" rel="stylesheet">
    <!-- Font Awesome for social icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>

    <header class="site-header">
        <div class="container">
            <div class="logo">
                <a href="index.html"><img src="images/Gemini_Generated_Image_eoegjueoegjueoeg.png" alt="Nassim's Stitches Logo"></a>
            </div>
            <nav class="main-nav">
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="shop.html">Shop</a></li>
                    <li><a href="about.html">About</a></li>
                    <li><a href="contact.html">Contact</a></li>
                </ul>
            </nav>
            <div class="header-actions">
                <a href="cart.html" class="cart-link" aria-label="View your shopping cart">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="cart-count">0</span>
                </a>
            </div>
            <!-- Mobile Menu Toggle Button -->
            <button class="menu-toggle" aria-label="Open navigation menu">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </button>
        </div>
    </header>

    <main>
        <header class="shop-header">
            <div class="container">
                <div class="breadcrumbs">
                    <a href="index.html">Home</a> &raquo; <span>Shop</span>
                </div>
                <h1>Our Creations</h1>
                <p>Discover our exclusive collection of handcrafted crochet items, made with love and precision.</p>
            </div>
        </header>

        <div class="container shop-container">
            <!-- Shop Sidebar for Filters -->
            <aside class="shop-sidebar">
                <div class="filter-widget">
                    <h4>Search Products</h4>
                    <div class="search-form">
                        <input type="search" id="search-input" placeholder="e.g. 'tote bag'">
                        <button id="search-btn" aria-label="Search"><i class="fas fa-search"></i></button>
                    </div>
                </div>
                <div class="filter-widget">
                    <h4>Categories</h4>
                    <ul id="category-filter">
                        <li><a href="#" data-filter="all" class="active">All</a></li>
                        <li><a href="#" data-filter="Tops">Tops</a></li>
                        <li><a href="#" data-filter="Skirts">Skirts</a></li>
                        <li><a href="#" data-filter="Bags">Bags</a></li>
                        <li><a href="#" data-filter="Accessories">Accessories</a></li>
                    </ul>
                </div>
                <div class="filter-widget">
                    <h4>Filter by Price</h4>
                    <ul id="price-filter">
                        <li><a href="#" data-filter="all">All Prices</a></li>
                        <li><a href="#" data-filter="0-2000">Under Ksh 2,000</a></li>
                        <li><a href="#" data-filter="2000-5000">Ksh 2,000 - Ksh 5,000</a></li>
                        <li><a href="#" data-filter="5000-Infinity">Over Ksh 5,000</a></li>
                    </ul>
                </div>
            </aside>

            <!-- Shop Products Grid -->
            <section class="shop-products">
                <!-- Sorting Controls -->
                <div class="shop-controls">
                    <p id="results-count">Showing 9 of 9 results</p>
                    <select name="orderby" class="orderby">
                        <option value="menu_order" selected="selected">Default sorting</option>
                        <option value="popularity">Sort by popularity</option>
                        <option value="date">Sort by newness</option>
                        <option value="price">Sort by price: low to high</option>
                        <option value="price-desc">Sort by price: high to low</option>
                    </select>
                </div>

                <div class="product-grid">
                    <div class="product-card" data-category="Bags" data-price="1000" data-date="2025-12-15">
                        <span class="product-badge">New</span>
                        <img src="images/WhatsApp Image 2025-12-15 at 22.31.02.jpeg" alt="Crochet Tote Bag" class="product-image">
                        <div class="product-info">
                            <h3 class="product-name">Crochet Tote Bag</h3>
                            <p class="product-price">Ksh 1,000</p>
                            <button class="btn view-item-btn" 
                                data-name="Crochet Tote Bag" 
                                data-price="Ksh 1,000" 
                                data-img="images/WhatsApp Image 2025-12-15 at 22.31.02.jpeg"
                                data-description="A stylish and durable tote bag, perfect for everyday use. Handcrafted with high-quality yarn."
                                data-id="P001">
                                View Item
                            </button>
                        </div>
                    </div>
                    <div class="product-card" data-category="Tops" data-price="5850" data-date="2025-12-14">
                        <img src="images/top.jpg" alt="Handmade Crochet Top" class="product-image">
                        <div class="product-info">
                            <h3 class="product-name">Handmade Crochet Top</h3>
                            <p class="product-price">Ksh 5,850</p>
                            <button class="btn view-item-btn" 
                                data-name="Handmade Crochet Top" 
                                data-price="Ksh 5,850" 
                                data-img="images/top.jpg"
                                data-description="An elegant and comfortable handmade crochet top, perfect for any occasion."
                                data-id="P002">
                                View Item
                            </button>
                        </div>
                    </div>
                    <div class="product-card" data-category="Skirts" data-price="7800" data-date="2025-12-13">
                        <img src="images/skirt.jpg" alt="Boho Crochet Skirt" class="product-image">
                        <div class="product-info">
                            <h3 class="product-name">Boho Crochet Skirt</h3>
                            <p class="product-price">Ksh 7,800</p>
                            <button class="btn view-item-btn" 
                                data-name="Boho Crochet Skirt" 
                                data-price="Ksh 7,800" 
                                data-img="images/skirt.jpg"
                                data-description="A beautiful Boho-style crochet skirt that adds a touch of elegance to your wardrobe."
                                data-id="P003">
                                View Item
                            </button>
                        </div>
                    </div>
                    <div class="product-card" data-category="Accessories" data-price="3250" data-date="2025-12-12">
                        <img src="images/beanie.jpg" alt="Cozy Crochet Beanie" class="product-image">
                        <div class="product-info">
                            <h3 class="product-name">Cozy Crochet Beanie</h3>
                            <p class="product-price">Ksh 3,250</p>
                            <button class="btn view-item-btn" 
                                data-name="Cozy Crochet Beanie" 
                                data-price="Ksh 3,250" 
                                data-img="images/beanie.jpg"
                                data-description="Keep warm with this cozy and stylish handmade crochet beanie."
                                data-id="P004">
                                View Item
                            </button>
                        </div>
                    </div>
                    <div class="product-card" data-category="Accessories" data-price="1040" data-date="2025-12-11">
                        <img src="images/scrunchie.jpg" alt="Velvet Crochet Scrunchie" class="product-image">
                        <div class="product-info">
                            <h3 class="product-name">Velvet Crochet Scrunchie</h3>
                            <p class="product-price">Ksh 1,040</p>
                            <button class="btn view-item-btn" 
                                data-name="Velvet Crochet Scrunchie" 
                                data-price="Ksh 1,040" 
                                data-img="images/scrunchie.jpg"
                                data-description="A soft, velvet crochet scrunchie to add a touch of class to your hairstyle."
                                data-id="P005">
                                View Item
                            </button>
                        </div>
                    </div>
                    <div class="product-card" data-category="Bags" data-price="7150" data-date="2025-12-10">
                        <img src="images/handbag.jpg" alt="Chic Crochet Handbag" class="product-image">
                        <div class="product-info">
                            <h3 class="product-name">Chic Crochet Handbag</h3>
                            <p class="product-price">Ksh 7,150</p>
                            <button class="btn view-item-btn" 
                                data-name="Chic Crochet Handbag" 
                                data-price="Ksh 7,150" 
                                data-img="images/handbag.jpg"
                                data-description="A chic and fashionable crochet handbag, perfect for a day out."
                                data-id="P006">
                                View Item
                            </button>
                        </div>
                    </div>
                    <div class="product-card" data-category="Accessories" data-price="1300" data-date="2025-12-09">
                        <img src="images/keychain.jpg" alt="Cute Crochet Keychain" class="product-image">
                        <div class="product-info">
                            <h3 class="product-name">Cute Crochet Keychain</h3>
                            <p class="product-price">Ksh 1,300</p>
                            <button class="btn view-item-btn" 
                                data-name="Cute Crochet Keychain" 
                                data-price="Ksh 1,300" 
                                data-img="images/keychain.jpg"
                                data-description="A cute and unique crochet keychain to personalize your keys or bag."
                                data-id="P007">
                                View Item
                            </button>
                        </div>
                    </div>
                    <div class="product-card" data-category="Bags" data-price="1000" data-date="2025-12-08">
                        <img src="images/WhatsApp Image 2025-12-15 at 22.33.28.jpeg" alt="Summer Crochet Tote" class="product-image">
                        <div class="product-info">
                            <h3 class="product-name">Summer Crochet Tote</h3>
                            <p class="product-price">Ksh 1,000</p>
                            <button class="btn view-item-btn" 
                                data-name="Summer Crochet Tote" 
                                data-price="Ksh 1,000" 
                                data-img="images/WhatsApp Image 2025-12-15 at 22.33.28.jpeg"
                                data-description="Light and breezy, this summer crochet tote is your perfect beach companion."
                                data-id="P008">
                                View Item
                            </button>
                        </div>
                    </div>
                    <div class="product-card" data-category="Tops" data-price="700" data-date="2025-12-07">
                        <img src="images/WhatsApp Image 2025-12-15 at 22.39.21.jpeg" alt="Raffle top" class="product-image">
                        <div class="product-info">
                            <h3 class="product-name">Raffle top</h3>
                            <p class="product-price">Ksh 700</p>
                            <button class="btn view-item-btn" 
                                data-name="Raffle top" 
                                data-price="Ksh 700" 
                                data-img="images/WhatsApp Image 2025-12-15 at 22.39.21.jpeg"
                                data-description="A fun and flirty raffle top, handcrafted to make a statement."
                                data-id="P009">
                                View Item
                            </button>
                        </div>
                    </div>
                    <!-- Add more product cards as needed -->
                </div>

                <!-- Pagination -->
                <div class="pagination">
                    <a href="#" class="btn btn-disabled">&laquo; Prev</a>
                    <a href="#" class="btn active">1</a>
                    <a href="#" class="btn">2</a>
                    <a href="#" class="btn">Next &raquo;</a>
                </div>
            </section>
        </div>
    </main>
    <footer class="site-footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-column footer-about">
                    <a href="index.html" class="footer-logo-link">
                        <img src="images/Gemini_Generated_Image_eoegjueoegjueoeg.png" alt="Nassim's Stitches Logo" class="footer-logo-img">
                        <span class="footer-site-name">Nassim's Stitches</span>
                    </a>
                    <p>Handcrafted crochet from the heart of Kakamega, Lurambi. Artistry in every stitch.</p>
                </div>

    <!-- Product Modal -->
    <div id="product-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-name">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <div class="modal-image-container">
                <img id="modal-img" src="" alt="Product Image" class="modal-image">
            </div>
            <div class="modal-info">
                <h2 id="modal-name" class="product-name">Product Name</h2>
                <p id="modal-price" class="product-price">Product Price</p>
                <p id="modal-description">Product description goes here.</p>
                <button id="modal-add-to-cart-btn" class="btn" style="margin-top: 20px;">Add to Cart</button>
            </div>
        </div>
    </div>
                <div class="footer-column">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="shop.html">Shop</a></li>
                        <li><a href="about.html">About</a></li>
                        <li><a href="contact.html">Contact</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h4>Follow Us</h4>
                    <!-- Replace '#' with your actual social media links -->
                    <div class="social-icons">
                        <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                        <a href="#" aria-label="Pinterest"><i class="fab fa-pinterest-p"></i></a>
                    </div>
                </div>
                <div class="footer-column">
                    <h4>Join Our Newsletter</h4>
                    <p>Get updates on new arrivals and special offers.</p>
                    <!-- input type="email" name="email" placeholder="Your email address" required>
                        <button type="submit" class="btn">Subscribe</button>
                    </form>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Nassim's Stitches. All Rights Reserved.</p>
            </div>
        </div>
    </footer>

    <div id="toast-container"></div>

    <script src="cart.js"></script> 
    <script>
        // This script needs to be loaded before the modal script that uses it.
        // Modal functionality
        const modal = document.getElementById('product-modal');
        const viewItemBtns = document.querySelectorAll('.view-item-btn');
        const closeModalBtn = document.querySelector('.close-button');
        let lastFocusedElement;
        const addToCartBtn = document.getElementById('modal-add-to-cart-btn');

        // Function to open the modal and populate it with data
        const openModal = (e) => {
            lastFocusedElement = document.activeElement; // Save the element that was focused
            const button = e.currentTarget;
            const card = button.closest('.product-card'); // Get the parent product card
            const priceValue = parseFloat(card.dataset.price); // Get the clean price from the card's data attribute

            document.getElementById('modal-name').textContent = button.dataset.name;
            document.getElementById('modal-price').textContent = button.dataset.price; // This is the display price string, e.g., "Ksh 1,000"
            document.getElementById('modal-img').src = button.dataset.img;
            document.getElementById('modal-description').textContent = button.dataset.description;
            
            // Store product data on the 'Add to Cart' button for later use
            addToCartBtn.dataset.id = button.dataset.id;
            addToCartBtn.dataset.name = button.dataset.name;
            addToCartBtn.dataset.price = priceValue;
            addToCartBtn.dataset.img = button.dataset.img;

            modal.classList.add('show');
            closeModalBtn.focus(); // Move focus to the close button
        };

        // Function to close the modal
        const closeModal = () => {
            modal.classList.remove('show');
            if (lastFocusedElement) {
                lastFocusedElement.focus(); // Return focus to the previously focused element
            }
        };

        // Add event listeners to all "View Item" buttons
        viewItemBtns.forEach(btn => {
            btn.addEventListener('click', openModal);
        });

        // Add event listener for the modal's "Add to Cart" button
        addToCartBtn.addEventListener('click', () => {
            const product = {
                id: addToCartBtn.dataset.id,
                name: addToCartBtn.dataset.name,
                price: parseFloat(addToCartBtn.dataset.price),
                img: addToCartBtn.dataset.img,
            };
            window.addToCart(product); // This function is in cart.js
            closeModal();
        });

        // Add event listener to the close button
        closeModalBtn.addEventListener('click', closeModal);

        // Add event listener for the Escape key to close the modal
        window.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && modal.classList.contains('show')) {
                closeModal();
            }
        });

        // Add event listener to close modal when clicking outside the content
        window.addEventListener('click', (e) => {
            if (e.target === modal) {
                closeModal();
            }
        });

    </script>
    <script src="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.min.js"></script>
    <script>
        // --- Shop Filtering and Sorting ---
        document.addEventListener('DOMContentLoaded', () => {
            const productGrid = document.querySelector('.product-grid');
            const productCards = Array.from(document.querySelectorAll('.product-card'));
            const categoryFilter = document.getElementById('category-filter');
            const priceFilter = document.getElementById('price-filter');
            const sortSelect = document.querySelector('.orderby');
            const resultsCount = document.getElementById('results-count');
            const searchInput = document.getElementById('search-input');

            // Create a comprehensive data source from the DOM
            const allProductsData = productCards.map(card => ({
                element: card,
                name: card.querySelector('.product-name').textContent,
                description: card.dataset.description || '',
                category: card.dataset.category,
                price: parseFloat(card.dataset.price),
                date: card.dataset.date,
            }));

            // Setup Fuse.js
            const fuse = new Fuse(allProductsData, {
                keys: ['name', 'description', 'category'],
                includeScore: true,
                threshold: 0.4,
            });

            let currentCategory = 'all';
            let currentPriceRange = 'all';
            let searchQuery = '';

            const updateGrid = () => {
                let productsToShow = allProductsData;

                // 1. Apply search if there's a query
                if (searchQuery.trim() !== '') {
                    productsToShow = fuse.search(searchQuery).map(result => result.item);
                }

                // 2. Apply filters (category and price)
                const filteredProducts = productsToShow.filter(product => {
                    const categoryMatch = currentCategory === 'all' || product.category === currentCategory;
                    
                    const price = product.price;
                    const [min, max] = currentPriceRange.split('-').map(parseFloat);
                    const priceMatch = currentPriceRange === 'all' || (price >= min && price <= (max || Infinity));

                    return categoryMatch && priceMatch;
                });

                // 3. Sort the filtered products
                const sortValue = sortSelect.value;
                filteredProducts.sort((a, b) => {
                    const priceA = a.price;
                    const priceB = b.price;
                    const dateA = new Date(a.date);
                    const dateB = new Date(b.date);

                    switch (sortValue) {
                        case 'price':
                            return priceA - priceB;
                        case 'price-desc':
                            return priceB - priceA;
                        case 'date':
                            return dateB - dateA;
                        default:
                            return 0; // 'menu_order' or 'popularity' can be default
                    }
                });

                // 4. Display results
                productGrid.innerHTML = '';
                filteredProducts.forEach(product => productGrid.appendChild(product.element));

                // 5. Update count
                resultsCount.textContent = `Showing ${filteredProducts.length} of ${allProductsData.length} results`;
            };

            // Category filter listener
            categoryFilter.addEventListener('click', e => {
                if (e.target.tagName === 'A') {
                    e.preventDefault();
                    categoryFilter.querySelector('.active').classList.remove('active');
                    e.target.classList.add('active');
                    currentCategory = e.target.dataset.filter;
                    updateGrid();
                }
            });

            // Price filter listener
            priceFilter.addEventListener('click', e => {
                if (e.target.tagName === 'A') {
                    e.preventDefault();
                    // Simple active state - can be improved
                    priceFilter.querySelectorAll('a').forEach(a => a.style.fontWeight = 'normal');
                    e.target.style.fontWeight = 'bold';
                    currentPriceRange = e.target.dataset.filter;
                    updateGrid();
                }
            });

            // Sort listener
            sortSelect.addEventListener('change', updateGrid);

            // Search listener
            searchInput.addEventListener('input', e => {
                searchQuery = e.target.value;
                updateGrid();
            });

            // Initial call to set up the grid
            updateGrid();
        });


    </script>

    <script>
        // Hamburger Menu Toggle
        const menuToggle = document.querySelector('.menu-toggle');
        const mainNav = document.querySelector('.main-nav');

        if (menuToggle && mainNav) {
            menuToggle.addEventListener('click', function() {
                mainNav.classList.toggle('is-open');
                this.classList.toggle('is-active');
            });
        }
    </script>

    <!-- Scroll to Top Button -->
    <a href="#" id="scrollToTopBtn" class="scroll-to-top-btn" title="Go to top"><i class="fas fa-arrow-up"></i></a>

    <script>
        // Scroll to top button functionality
        const scrollToTopBtn = document.getElementById('scrollToTopBtn');

        if (scrollToTopBtn) {
            window.onscroll = function() {
                if (document.body.scrollTop > 100 || document.documentElement.scrollTop > 100) {
                    scrollToTopBtn.classList.add('show');
                } else {
                    scrollToTopBtn.classList.remove('show');
                }
            };

            scrollToTopBtn.addEventListener('click', function(e) {
                e.preventDefault();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });

            // Scroll animation for product cards
            const cardsForAnimation = document.querySelectorAll('.product-card');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('is-visible');
                        observer.unobserve(entry.target); // Stop observing once visible
                    }
                });
            }, {
                threshold: 0.1 // Trigger when 10% of the item is visible
            });

            cardsForAnimation.forEach(card => {
                observer.observe(card);
            });
        }
    </script>
</body>
</html>